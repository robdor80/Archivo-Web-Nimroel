<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Archivo del Santuario</title>

  <!-- BASE PARA GITHUB -->
  <base href="/Archivo-Web-Nimroel/">

  <!-- Estilos -->
  <link rel="stylesheet" href="styles.css?v=1.5">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta name="theme-color" content="#0e111c">
</head>

<body>
  <!-- üåå Fondo de runas flotantes -->
  <div id="runas"></div>

  <!-- üí† Pantalla principal -->
  <div class="fondo-cristal inicio">
    <header class="cabecera">
      <h1>Bienvenido al Archivo del Santuario</h1>
      <h2>Recuerde que el Gran Sello de Jorvin monitoriza la sesi√≥n.</h2>

      <!-- L√≠nea separadora -->
      <hr class="separador">

      <!-- Men√∫ principal -->
      <nav class="menu-inicio">
        <a href="#" id="btnCustodio">Custodio</a>
        <a href="#">Configuraci√≥n</a>
        <a href="terminal.html">Terminal</a>
      </nav>
    </header>

    <!-- üí† Disposici√≥n de Runas -->
    <section class="portal-runas oculto" id="portalRunas">
      <div class="tabla-runas">
        <!-- Fila 1 -->
        <div></div>
        <a href="#" class="runa-enlace" data-num="1"><img src="medios/img/runas/runa1.webp" alt="Runa 1"></a>
        <div></div>
        <a href="#" class="runa-enlace" data-num="2"><img src="medios/img/runas/runa2.webp" alt="Runa 2"></a>
        <div></div>

        <!-- Fila 2 -->
        <a href="#" class="runa-enlace" data-num="3"><img src="medios/img/runas/runa3.webp" alt="Runa 3"></a>
        <div></div>
        <a href="#" class="runa-enlace" data-num="4"><img src="medios/img/runas/runa4.webp" alt="Runa 4"></a>
        <div></div>
        <a href="#" class="runa-enlace" data-num="5"><img src="medios/img/runas/runa5.webp" alt="Runa 5"></a>

        <!-- Fila 3 -->
        <div></div>
        <a href="#" class="runa-enlace" data-num="6"><img src="medios/img/runas/runa6.webp" alt="Runa 6"></a>
        <div></div>
        <a href="#" class="runa-enlace" data-num="7"><img src="medios/img/runas/runa7.webp" alt="Runa 7"></a>
        <div></div>
      </div>

      <!-- üîê Zona de acceso -->
      <div class="acceso oculto" id="zonaAcceso">
        <button id="btnGoogle">Iniciar sesi√≥n con Google</button>
        <button id="btnAcceso">Acceso</button>
      </div>
    </section>
  </div>

  <!-- üåßÔ∏è Lluvia de runas decorativa -->
  <script>
    const RUNAS = ["·ö†","·ö¢","·ö¶","·ö®","·ö±","·ö≤","·ö∑","·öπ","·ö∫","·öæ","·õÅ","·õÉ","·õá","·õâ","·õä","·õè","·õí","·õñ","·õó","·õö","·õú","·õû","·õü"];
    function generarLluviaRunas() {
      const capa = document.getElementById("runas");
      capa.innerHTML = "";
      const cantidad = window.innerWidth < 768 ? 40 : 80;
      for (let i = 0; i < cantidad; i++) {
        const rune = document.createElement("div");
        rune.className = "runa";
        rune.textContent = RUNAS[Math.floor(Math.random() * RUNAS.length)];
        rune.style.left = Math.random() * 100 + "vw";
        rune.style.top = "-" + (Math.random() * 20 + 5) + "vh";
        rune.style.animationDuration = 4 + Math.random() * 6 + "s";
        rune.style.animationDelay = "-" + Math.random() * 10 + "s";
        capa.appendChild(rune);
      }
    }
    window.addEventListener("DOMContentLoaded", generarLluviaRunas);
  </script>

  <!-- ‚öôÔ∏è Script principal -->
  <script>
    const btnCustodio = document.getElementById('btnCustodio');
    const portalRunas = document.getElementById('portalRunas');
    const zonaAcceso = document.getElementById('zonaAcceso');
    const runas = document.querySelectorAll('.runa-enlace');

    let secuenciaCorrecta = ["6", "7", "7", "4"];
    let secuenciaActual = [];
    let bloqueado = false; // ‚è≥ evita clics demasiado r√°pidos

    // Ocultar todo al inicio
    portalRunas.classList.add('oculto');
    zonaAcceso.classList.add('oculto');

    // Mostrar / ocultar runas al pulsar Custodio
    btnCustodio.addEventListener('click', (e) => {
      e.preventDefault();
      portalRunas.classList.toggle('oculto');
      zonaAcceso.classList.add('oculto');
      secuenciaActual = [];
    });

    // Controlar pulsaciones de runas con retardo de 300 ms
    runas.forEach(runa => {
      runa.addEventListener('click', (e) => {
        e.preventDefault();
        if (bloqueado) return; // evita clics demasiado r√°pidos
        bloqueado = true;

        const num = runa.dataset.num;
        secuenciaActual.push(num);

        // Si ya hay 4 pulsaciones, comprobar
        if (secuenciaActual.length === 4) {
          if (JSON.stringify(secuenciaActual) === JSON.stringify(secuenciaCorrecta)) {
            // ‚úÖ Secuencia correcta
            runas.forEach(r => r.classList.remove('runa-error'));
            runa.classList.add('runa-acierto');

            setTimeout(() => {
              zonaAcceso.classList.remove('oculto');
              zonaAcceso.classList.add('aparecer', 'mostrar');
            }, 500);
          } else {
            // ‚ùå Secuencia incorrecta
            runas.forEach(r => r.classList.add('runa-error'));
            setTimeout(() => {
              runas.forEach(r => r.classList.remove('runa-error'));
            }, 600);
          }
          secuenciaActual = [];
        }

        // Espera 300 ms antes de permitir otro clic
        setTimeout(() => bloqueado = false, 300);
      });
    });
  </script>

  <!-- üîÑ Limpieza de cach√© -->
  <script>
    if ('caches' in window) {
      caches.keys().then(names => names.forEach(n => caches.delete(n)));
    }
    if (!sessionStorage.getItem('cacheCleared')) {
      sessionStorage.setItem('cacheCleared', 'true');
      window.location.reload(true);
    }
  </script>

  <!-- ==========================================================
     üîê LOGIN CON GOOGLE ‚Äî SOLO PARA ROB.DOR.80@GMAIL.COM
     ========================================================== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  const firebaseConfig = {
  apiKey: "AIzaSyD3NEbGcUwBxwoOGBPO8PukmPHcfl42bE8",
  authDomain: "cronicas-de-nimroel.firebaseapp.com",
  projectId: "cronicas-de-nimroel",
  storageBucket: "cronicas-de-nimroel.appspot.com",
  messagingSenderId: "689465837057",
  appId: "1:689465837057:web:aecddb8b4a247bfe0de200"
};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const btnGoogle = document.getElementById("btnGoogle");
  const btnAcceso = document.getElementById("btnAcceso");

  const CORREO_AUTORIZADO = "rob.dor.80@gmail.com";

  btnAcceso.disabled = true;
  btnAcceso.style.opacity = "0.5";
  btnAcceso.style.cursor = "not-allowed";

  btnGoogle.addEventListener("click", async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      if (user.email === CORREO_AUTORIZADO) {
        alert("‚ú® Bienvenido, Custodio del Santuario.");
        btnAcceso.disabled = false;
        btnAcceso.style.opacity = "1";
        btnAcceso.style.cursor = "pointer";
      } else {
        alert("üö´ El Sello de Jorvin no reconoce tu esencia. Acceso denegado.");
        await signOut(auth);
        btnAcceso.disabled = true;
        btnAcceso.style.opacity = "0.5";
        btnAcceso.style.cursor = "not-allowed";
      }
    } catch (error) {
      console.error("Error de autenticaci√≥n:", error);
      alert("‚ö†Ô∏è No se pudo iniciar sesi√≥n. Int√©ntalo de nuevo.");
    }
  });

  btnAcceso.addEventListener("click", () => {
    if (!btnAcceso.disabled) {
      alert("üîì Acceso concedido al Archivo del Santuario.");
      window.location.href = "paginas/admin/acceso.html";
    } else {
      alert("üö´ No tienes autorizaci√≥n. Inicia sesi√≥n primero.");
    }
  });
</script>

</body>
</html>
